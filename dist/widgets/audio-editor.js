import{u as Sa,a as ba,r as i,b as ya,t as Ca,j as t,c as $e,d as Aa,e as Ft,f as kt,g as Ta,h as Ua,i as Ea,k as ja}from"./analytics-DONYtF83.js";const he={},lt=!(typeof window<"u"&&window.__DEBUG__==="false"||(he==null?void 0:he.DEBUG)==="false"||(he==null?void 0:he.VITE_DEBUG)==="false"),f=(...u)=>{lt&&console.log(...u)},Ue=(...u)=>{lt&&console.warn(...u)},Ee=(...u)=>{lt&&console.error(...u)},ge=(u,M="audio")=>{if(!u||typeof u!="string")return M;const O=u.replace(/[<>:"/\\|?*\x00-\x1F]/g,"").trim().replace(/\s+/g,"-");return O.length>0?O:M},It=1.5,Wt=[{value:"mp3",label:"MP3"},{value:"wav",label:"WAV"},{value:"flac",label:"FLAC"},{value:"ogg",label:"OGG (Opus)"},{value:"m4a",label:"M4A (AAC)"},{value:"m4r",label:"M4R (iOS Ringtone)"}],Ma=[{value:"m4r",label:"iPhone (.m4r)"},{value:"ogg",label:"Android (.ogg)"}],Na=Wt.map(u=>u.value),_t=u=>{var O;const M=(O=u==null?void 0:u.device)==null?void 0:O.type;if(M==="mobile"||M==="tablet"){const Y=navigator.userAgent.toLowerCase();if(/iphone|ipad|ipod/.test(Y))return"ios";if(/android/.test(Y))return"android"}return"unknown"},Bt=u=>{const M=_t(u);return M==="ios"?"m4r":M==="android"?"ogg":"mp3"},$t="mp3",Vt=u=>{if(!u||typeof u!="string")return $t;const M=u.toLowerCase();return Na.includes(M)?M:$t};function Oa(){const u=Sa(),M=ba(),O=(u==null?void 0:u.mode)==="ringtone",Y=_t(M.userAgent),[E,T]=i.useState(!1),[P,je]=i.useState(()=>O?Y==="ios"?"m4r":"ogg":Bt(M.userAgent)),[J,ct]=i.useState(""),[k,dt]=i.useState(!1),[I,ut]=i.useState(!1),[L,Ve]=i.useState(0),[D,We]=i.useState(0),[Me,zt]=i.useState(!1),[mt,_e]=i.useState(!1),[we,Gt]=i.useState([]),[$,ft]=i.useState(0),[Pa,Zt]=i.useState(0),[ze,Ht]=i.useState(0),[Kt,pt]=i.useState(0),[Xt,ht]=i.useState(""),[z,Ge]=i.useState(null),[ne,Ze]=i.useState(null),[ve,G]=i.useState(!1),[F,xe]=i.useState(!0),[C,Ne]=i.useState(.2),[y,Oe]=i.useState(.6),[He,R]=i.useState(.25),[Pe,gt]=i.useState(!1),[Re,wt]=i.useState(!1),[Le,vt]=i.useState(!1),Z=i.useRef(!1),H=i.useRef(null),De=i.useRef(null),Se=i.useRef(null),B=i.useRef(null),V=i.useRef([]),Fe=i.useRef(null),Q=i.useRef(null),be=i.useRef(null),Ke=i.useRef(null),[qt,Xe]=i.useState(""),[W,Yt]=i.useState(null),[oe,Jt]=i.useState(null),[Qt,ea]=i.useState(null),[ta,qe]=i.useState(null),ee=i.useRef(null),re=i.useRef(null),[Ye,xt]=i.useState(!1),[St,X]=i.useState(null),[bt,ye]=i.useState(""),[Je,yt]=i.useState(null),[Ra,se]=i.useState(null),aa=ya(),[ie,Ct]=i.useState(!1),[na,Qe]=i.useState("Separating..."),[A,At]=i.useState(!1),[et,Tt]=i.useState(null),[tt,Ut]=i.useState(null),[j,at]=i.useState(!0),[N,nt]=i.useState(!0),le=i.useRef(null),Ce=i.useRef(null),[Ae,Et]=i.useState([]),[Te,jt]=i.useState([]);i.useEffect(()=>{X(null),ye(""),yt(null)},[P]),i.useEffect(()=>{if(!ie){Qe("Separating...");return}const e=["Separating...","Processing...","Almost there..."];let n=0;Qe(e[n]);const a=setInterval(()=>{n=(n+1)%e.length,Qe(e[n])},1e4);return()=>clearInterval(a)},[ie]),i.useEffect(()=>{u!=null&&u.defaultFormat?je(Vt(u.defaultFormat)):je(O?Y==="ios"?"m4r":"ogg":Bt(M.userAgent))},[u==null?void 0:u.defaultFormat,u==null?void 0:u.mode,M.userAgent,O,Y]),i.useEffect(()=>{var e,n;f("ðŸ” [COMPONENT MOUNT] window.openai available:",{windowOpenai:window.openai,hasOpenai:!!window.openai,availableKeys:window.openai?Object.keys(window.openai).filter(a=>typeof window.openai[a]!="function"):[],hasToolOutput:!!((e=window.openai)!=null&&e.toolOutput),hasToolInput:!!((n=window.openai)!=null&&n.toolInput)}),Ca({mode:O?"ringtone":"audio",platform:Y||"desktop"})},[]);const oa=e=>!e||e<=0?"0 kHz":`${Math.round(e/1e3)} kHz`,ot=(e,n)=>{if(n&&n.name){const a=n.name,r=a.lastIndexOf(".");if(r>0&&r<a.length-1){const o=a.substring(r+1).toLowerCase();return{mp3:"MP3",wav:"WAV",m4a:"M4A",m4r:"M4R",flac:"FLAC",ogg:"OGG",aac:"AAC",webm:"WebM"}[o]||o.toUpperCase()}}if(e){const a=e.split("?")[0];try{const c=new URL(a).pathname.split("/").pop()||"",s=c.lastIndexOf(".");if(s>0&&s<c.length-1){const m=c.substring(s+1).toLowerCase();if(m.length<=5&&/^[a-z0-9]+$/i.test(m))return{mp3:"MP3",wav:"WAV",m4a:"M4A",m4r:"M4R",flac:"FLAC",ogg:"OGG",aac:"AAC",webm:"WebM"}[m]||m.toUpperCase()}}catch{const r=a.lastIndexOf(".");if(r>0){const c=a.substring(r+1).split(/[?#]/)[0].toLowerCase();if(c.length<=5&&/^[a-z0-9]+$/i.test(c))return{mp3:"MP3",wav:"WAV",m4a:"M4A",m4r:"M4R",flac:"FLAC",ogg:"OGG",aac:"AAC",webm:"WebM"}[c]||c.toUpperCase()}}}return""},Mt=()=>{const e=[];return z!==null&&z>0&&e.push(`BPM: ${z}`),ne&&e.push(`Key: ${ne}`),ze>0&&e.push(`S.R.: ${oa(ze)}`),e.join(" â€¢ ")};i.useEffect(()=>{if(ve)return;const e=Mt();if(!e||e.trim()===""){Xe("");return}if(Ke.current){const n=()=>{const r=Ke.current;if(r){const o=r.parentElement;if(o&&o.offsetWidth>0){const c=document.createElement("span");c.textContent=e,c.style.position="absolute",c.style.visibility="hidden",c.style.whiteSpace="nowrap",c.style.fontSize=window.getComputedStyle(r).fontSize,c.style.fontFamily=window.getComputedStyle(r).fontFamily,c.style.fontWeight=window.getComputedStyle(r).fontWeight,document.body.appendChild(c);const s=c.offsetWidth;document.body.removeChild(c);const m=o.offsetWidth;if(s>0){const w=Math.max(2,Math.ceil(m*2.5/s));Xe((e+" â€¢ ").repeat(w))}else Xe(e+" â€¢ "+e)}}},a=requestAnimationFrame(()=>{setTimeout(n,0)});return window.addEventListener("resize",n),()=>{cancelAnimationFrame(a),window.removeEventListener("resize",n)}}},[ze,z,ne,ve]);const te=C*$,ce=y*$,rt=(e,n={})=>{if(!De.current||!H.current)return e*100;const a=De.current.getBoundingClientRect(),r=H.current.getBoundingClientRect(),o=r.left-a.left,c=e*r.width;let m=(o+c)/a.width*100;if(n.applyPinOffset){const w=o/a.width*100;m+=w}return m},[ra,sa]=i.useState(0),[Nt,ia]=i.useState(0),[Ot,la]=i.useState(0);i.useEffect(()=>{const e=()=>{requestAnimationFrame(()=>{if(De.current&&H.current){sa(rt(He));const n=2;ia(rt(C)+n),la(rt(y)+n)}})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[He,C,y,F,we.length,A]);const st=async e=>{const n=window.innerWidth;let a;n<425?a=55:n>=1024?a=200:a=100;const r=e.getChannelData(0),o=Math.max(1,Math.floor(r.length/a)),c=[];for(let s=0;s<a;s++){const m=o*s;let w=0,x=0;const b=Math.min(m+o,r.length);for(let l=m;l<b;l++)w+=Math.abs(r[l]),x++;const d=x>0?w/x:0;c.push(Math.max(.1,d*3.5))}return c},ca=(e,n)=>{const a=Math.max(...e),r=Math.max(...n),o=Math.max(a,r);if(o<=0||a<=0&&r<=0)return[e,n];const c=a>0?e.map(m=>{const w=m/a*o;return Math.max(.1,w)}):e,s=r>0?n.map(m=>{const w=m/r*o;return Math.max(.1,w)}):n;return[c,s]},da=(e,n=30)=>{const a=e.getChannelData(0),r=e.sampleRate,o=e.duration;if(o<=n)return{start:0,end:1};const c=r,s=[];for(let l=0;l<a.length-c;l+=Math.floor(c/4)){let p=0;for(let h=l;h<l+c&&h<a.length;h++)p+=a[h]*a[h];const g=Math.sqrt(p/c),S=l/r;s.push({time:S,rms:g})}const m=Math.ceil(n);let w=0,x=0;for(let l=0;l<=s.length-m;l++){let p=0;for(let S=l;S<l+m&&S<s.length;S++)p+=s[S].rms;const g=p/m;g>x&&(x=g,w=s[l].time)}const b=w/o,d=Math.min((w+n)/o,1);return{start:b,end:d}},ua=e=>{const a=e.split("?")[0].split("/");let r=a[a.length-1];return r=r.replace(/\.[^/.]+$/,""),!r||r.length<3||r.startsWith("file-")?"Audio File":r},Pt=e=>typeof e=="string"&&e.includes("/mnt/data/"),de=()=>W?{url:W,name:oe,file:Qt,isUploaded:!0}:u!=null&&u.audioUrl&&!Pt(u.audioUrl)?{url:u.audioUrl,name:ua(u.audioUrl),file:null,isUploaded:!1}:null;i.useEffect(()=>{if(u!=null&&u.audioUrl&&Pt(u.audioUrl)){Ue("âš ï¸ [FILE SOURCE] Detected unsupported ChatGPT conversation path. Prompting user to upload via widget.",{audioUrl:u.audioUrl}),se("Files added via the ChatGPT conversation arenâ€™t accessible here. Please upload the audio using the Select File button below.");return}u!=null&&u.audioUrl&&se(null)},[u==null?void 0:u.audioUrl]);const ma=(e,n="button")=>{if(f(`ðŸ“¤ [FILE UPLOAD] File ${n} event triggered`,{timestamp:new Date().toISOString(),fileName:e.name,fileSize:e.size}),se(null),At(!1),Tt(null),Ut(null),Et([]),jt([]),at(!0),nt(!0),le.current=null,Ce.current=null,!e){Ue("âš ï¸ [FILE UPLOAD] No file provided");return}if(typeof e.path=="string"&&e.path.includes("/mnt/data/")){Ue("âš ï¸ [FILE UPLOAD] File path indicates ChatGPT conversation storage. Rejecting upload.",{filePath:e.path}),se("Files attached in the ChatGPT chat can't be loaded. Please choose the audio file using this uploader.");return}f("ðŸ“„ [FILE UPLOAD] File selected:",{name:e.name,size:e.size,sizeMB:(e.size/(1024*1024)).toFixed(2),type:e.type,lastModified:new Date(e.lastModified).toISOString()});const a=["audio/mpeg","audio/mp3","audio/wav","audio/m4a","audio/x-m4a","audio/aac","audio/ogg","audio/webm"],r=[".mp3",".wav",".m4a",".aac",".ogg",".webm"],o="."+e.name.split(".").pop().toLowerCase();if(f("ðŸ” [FILE UPLOAD] Validating file:",{fileType:e.type,fileExtension:o,isValidType:a.includes(e.type),isValidExtension:r.includes(o)}),!a.includes(e.type)&&!r.includes(o)){Ee("âŒ [FILE UPLOAD] Invalid file type:",{fileType:e.type,fileExtension:o,validTypes:a,validExtensions:r}),se("Please upload a valid audio file (MP3, WAV, M4A, AAC, OGG, or WebM)");return}f("ðŸ”— [FILE UPLOAD] Creating object URL...");const c=URL.createObjectURL(e);f("âœ… [FILE UPLOAD] Object URL created:",{objectUrl:c,fileName:e.name.replace(/\.[^/.]+$/,"")}),Yt(c),Jt(e.name.replace(/\.[^/.]+$/,"")),ea(e),qe(null),f("ðŸ’¾ [FILE UPLOAD] State updated - file ready for processing");const s=ge(e.name.replace(/\.[^/.]+$/,""),"audio-file");Ea({upload_method:n,file_type:e.type||o,file_size:e.size,file_name:s}),ee.current&&(ee.current.value="")},fa=e=>{var r,o;const n=((r=e==null?void 0:e.target)==null?void 0:r.value)??"";if(typeof n=="string"&&n.includes("/mnt/data/")){Ue("âš ï¸ [FILE UPLOAD] File selected from ChatGPT conversation path. Rejecting to keep upload screen.",{inputPath:n}),se("Looks like that file was attached in the ChatGPT chat. Please upload the audio directly through this screen."),ee.current&&(ee.current.value="");return}const a=(o=e.target.files)==null?void 0:o[0];a&&ma(a,"button")};i.useEffect(()=>{const e=de();if(re.current=null,X(null),ye(""),!e){xe(!1),G(!1),Ge(null),Ze(null);return}G(!1),Ge(null),Ze(null),f("ðŸ” [AUDIO LOAD] Checking for file access:",{hasOpenai:!!window.openai,hasFilesAPI:!!(window.openai&&window.openai.files),audioSourceType:e.isUploaded?"uploaded":"external"}),f("ðŸŽµ [AUDIO LOAD] Starting audio load process:",{timestamp:new Date().toISOString(),source:e.name,url:e.url,isUploaded:!!W}),(async()=>{try{xe(!0),f("â³ [AUDIO LOAD] Loading audio file...");let a;const r=performance.now();if(e.isUploaded&&e.file){f("ðŸ“– [AUDIO LOAD] Using FileReader for uploaded file (avoiding CSP fetch issue)"),pt(e.file.size),ht(ot(null,e.file));const v=performance.now();a=await new Promise((U,K)=>{const _=new FileReader;_.onload=ae=>{const fe=((performance.now()-v)/1e3).toFixed(2);f("ðŸ“¥ [AUDIO LOAD] File read via FileReader:",{sizeBytes:ae.target.result.byteLength,sizeMB:(ae.target.result.byteLength/(1024*1024)).toFixed(2),readTimeSeconds:fe}),U(ae.target.result)},_.onerror=K,_.readAsArrayBuffer(e.file)})}else{f("ðŸŒ [AUDIO LOAD] Using fetch for external URL");const v=performance.now(),U=await fetch(e.url),K=((performance.now()-v)/1e3).toFixed(2);f("ðŸ“¥ [AUDIO LOAD] File fetched:",{status:U.status,statusText:U.statusText,contentType:U.headers.get("content-type"),size:U.headers.get("content-length"),fetchTimeSeconds:K});const _=performance.now();a=await U.arrayBuffer();const ae=((performance.now()-_)/1e3).toFixed(2);f("ðŸ’¾ [AUDIO LOAD] ArrayBuffer created:",{sizeBytes:a.byteLength,sizeMB:(a.byteLength/(1024*1024)).toFixed(2),conversionTimeSeconds:ae}),pt(a.byteLength);const fe=U.headers.get("content-type");let pe="";if(fe){const it={"audio/mpeg":"MP3","audio/mp3":"MP3","audio/wav":"WAV","audio/wave":"WAV","audio/x-wav":"WAV","audio/m4a":"M4A","audio/x-m4a":"M4A","audio/mp4":"M4A","audio/m4r":"M4R","audio/flac":"FLAC","audio/x-flac":"FLAC","audio/ogg":"OGG","audio/opus":"OGG","audio/aac":"AAC","audio/webm":"WebM"},xa=fe.split(";")[0].toLowerCase();pe=it[xa]||""}pe||(pe=ot(e.url,null)),ht(pe)}const o=performance.now(),c=new(window.AudioContext||window.webkitAudioContext),s=await c.decodeAudioData(a),m=((performance.now()-o)/1e3).toFixed(2);f("ðŸŽ¼ [AUDIO LOAD] Audio decoded:",{duration:s.duration,durationFormatted:`${Math.floor(s.duration/60)}:${(s.duration%60).toFixed(2)}`,sampleRate:s.sampleRate,numberOfChannels:s.numberOfChannels,length:s.length,decodeTimeSeconds:m}),Se.current=c,re.current=s,ft(s.duration),Zt(s.numberOfChannels),Ht(s.sampleRate);const w=performance.now(),x=await st(s),b=((performance.now()-w)/1e3).toFixed(2);f("ðŸ“Š [AUDIO LOAD] Waveform generated:",{samples:x.length,waveformTimeSeconds:b}),Gt(x);const d=e.isUploaded?W?"manual":"drag_drop":"chatgpt_url";Aa({source:d,duration:s.duration,format:Xt||ot(e.url,e.file),sample_rate:s.sampleRate,channels:s.numberOfChannels,file_size:Kt||a.byteLength});let l=null;try{f("ðŸ” [AUDIO LOAD] Attempting to extract metadata...");const v=document.createElement("audio");v.src=e.url,await new Promise((U,K)=>{v.addEventListener("loadedmetadata",()=>{l=v.title||null,f("ðŸ“‹ [AUDIO LOAD] Metadata extracted:",{title:l,duration:v.duration,readyState:v.readyState}),U()}),v.addEventListener("error",_=>{f("â„¹ï¸ [AUDIO LOAD] Metadata extraction skipped (CSP or browser limitation)"),U()}),setTimeout(()=>{f("â±ï¸ [AUDIO LOAD] Metadata extraction timeout"),U()},100)})}catch(v){f("â„¹ï¸ [AUDIO LOAD] Metadata extraction skipped:",v.message)}const p=l||e.name||"Audio File";f("âœï¸ [AUDIO LOAD] Setting track name:",{displayName:p,source:l?"metadata":"filename"}),ct(p);let g,S;if(O&&s.duration>30){const v=da(s,30);g=v.start,S=v.end,Ne(g),Oe(S),R(g),dt(!0),ut(!0);const U=Math.min(1.5,(v.end-v.start)*s.duration/4);Ve(U),We(U);const K=v.start*s.duration,_=v.end*s.duration,ae=Math.floor(K/60),fe=(K%60).toFixed(1),pe=Math.floor(_/60),it=(_%60).toFixed(1);f("ðŸŽµ [RINGTONE] Auto-selected best 30-second segment:",{start:v.start,end:v.end,startTime:`${ae}:${fe.padStart(4,"0")}`,endTime:`${pe}:${it.padStart(4,"0")}`,fadeDuration:U})}else g=.1,S=O&&s.duration<=30?1:.7,Ne(g),Oe(S),R(g);const h=((performance.now()-r)/1e3).toFixed(2);f("âœ… [AUDIO LOAD] Audio loaded successfully!",{trackName:p,duration:s.duration,trimStart:g,trimEnd:S,totalLoadTimeSeconds:h,loadMethod:e.isUploaded?"FileReader":"fetch"}),xe(!1),pa(e)}catch(a){Ee("âŒ [AUDIO LOAD] Error loading audio:",{error:a.message,stack:a.stack,name:a.name,audioSource:e.name}),Ft({error_type:"load",error_message:a.message||"Unknown error loading audio",context:{audio_source:e.isUploaded?"uploaded":"external",has_url:!!e.url}}),re.current=null;const r=e.name||"Audio File";f("ðŸ”„ [AUDIO LOAD] Using fallback name:",r),ct(r),xe(!1)}})()},[W,u==null?void 0:u.audioUrl]);const pa=async e=>{G(!0);try{const n=typeof window<"u"&&window.__API_BASE_URL__;if(!n){f("âš ï¸ [BPM/KEY] API URL not available, skipping detection"),G(!1);return}let a=e.url;if(e.isUploaded&&e.file){f("ðŸ“¤ [BPM/KEY] Uploading file to S3 for detection...");const c=await fetch(`${n.replace(/\/$/,"")}/api/s3-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.file.name,contentType:e.file.type||"audio/mpeg"})});if(!c.ok){f("âš ï¸ [BPM/KEY] Failed to get presigned URL, skipping detection"),G(!1);return}const{uploadUrl:s,publicUrl:m}=await c.json();if(!(await fetch(s,{method:"PUT",body:e.file,headers:{"Content-Type":e.file.type||"audio/mpeg"}})).ok){f("âš ï¸ [BPM/KEY] Failed to upload to S3, skipping detection"),G(!1);return}a=m,qe(m),f("âœ… [BPM/KEY] File uploaded to S3:",m)}f("ðŸ” [BPM/KEY] Detecting BPM and Key...");const r=await fetch(`${n.replace(/\/$/,"")}/api/detect-bpm-key`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioUrl:a})});if(!r.ok){f("âš ï¸ [BPM/KEY] Detection API failed:",r.status),G(!1);return}const o=await r.json();f("âœ… [BPM/KEY] Detection complete:",o),o.bpm!==null&&o.bpm!==void 0&&Ge(o.bpm),o.key&&Ze(o.key),G(!1)}catch(n){f("âš ï¸ [BPM/KEY] Detection error (non-critical):",n.message),G(!1)}};i.useEffect(()=>()=>{W&&W.startsWith("blob:")&&URL.revokeObjectURL(W)},[W]),i.useEffect(()=>{const e=()=>{if(V.current&&V.current.length>0&&(V.current.forEach(a=>{try{a.stop()}catch{}}),V.current=[]),B.current){try{B.current.stop()}catch{}B.current=null}Q.current&&(cancelAnimationFrame(Q.current),Q.current=null),Fe.current&&(Fe.current=null),be.current=null};return!Se.current||!E?(e(),e):(e(),(async()=>{try{const a=Se.current;a.state==="suspended"&&await a.resume();const r=te,c=ce-r;if(A&&le.current&&Ce.current){if(!j&&!N){T(!1);return}const s=[],m=[],w=a.createChannelMerger(2);if(j){const p=a.createBufferSource(),g=a.createGain();p.buffer=le.current,p.connect(g),g.connect(w,0,0),s.push(p),m.push(g)}if(N){const p=a.createBufferSource(),g=a.createGain();p.buffer=Ce.current,p.connect(g);const S=j?1:0;g.connect(w,0,S),s.push(p),m.push(g)}if(w.connect(a.destination),m.forEach(p=>{p.gain.setValueAtTime(1,a.currentTime)}),k&&L>0&&m.forEach(p=>{p.gain.setValueAtTime(0,a.currentTime),p.gain.linearRampToValueAtTime(1,a.currentTime+L)}),I&&D>0){const p=a.currentTime+c-D;m.forEach(g=>{g.gain.setValueAtTime(1,p),g.gain.linearRampToValueAtTime(0,a.currentTime+c)})}V.current=s,B.current=s[0],Fe.current=m[0];const x=a.currentTime;be.current=x;const b=()=>{if(!E)return;const p=a.currentTime-x,g=Math.min(p/c,1),S=C+(y-C)*g;if(R(S),g>=1){T(!1),R(y);return}Q.current=requestAnimationFrame(b)};s.forEach(p=>{p.start(x,r),p.stop(x+c)});let d=0;const l=()=>{d++,d>=s.length&&(T(!1),R(y),V.current=[],B.current=null,be.current=null)};s.forEach(p=>{p.onended=l}),b()}else{const s=de();if(!s){T(!1);return}let m;s.isUploaded&&s.file?m=await new Promise((p,g)=>{const S=new FileReader;S.onload=h=>p(h.target.result),S.onerror=g,S.readAsArrayBuffer(s.file)}):m=await(await fetch(s.url)).arrayBuffer();const w=await a.decodeAudioData(m),x=a.createBufferSource(),b=a.createGain();if(x.buffer=w,x.connect(b),b.connect(a.destination),B.current=x,Fe.current=b,k&&L>0?(b.gain.setValueAtTime(0,a.currentTime),b.gain.linearRampToValueAtTime(1,a.currentTime+L)):b.gain.setValueAtTime(1,a.currentTime),I&&D>0){const p=a.currentTime+c-D;b.gain.setValueAtTime(1,p),b.gain.linearRampToValueAtTime(0,a.currentTime+c)}const d=a.currentTime;be.current=d;const l=()=>{if(!E||!B.current)return;const p=a.currentTime-d,g=Math.min(p/c,1),S=C+(y-C)*g;if(R(S),g>=1){T(!1),R(y);return}Q.current=requestAnimationFrame(l)};x.start(d,r),x.stop(d+c),x.onended=()=>{T(!1),R(y),B.current=null,be.current=null},l()}}catch(a){Ee("Error playing audio:",a),T(!1),e()}})(),e)},[E,te,ce,k,I,L,D,C,y,W,u==null?void 0:u.audioUrl,A,j,N]),i.useEffect(()=>()=>{if(V.current&&V.current.length>0&&(V.current.forEach(e=>{try{e.stop()}catch{}}),V.current=[]),B.current){try{B.current.stop()}catch{}B.current=null}Q.current&&cancelAnimationFrame(Q.current),Se.current&&Se.current.close()},[]);const ke=e=>{const n=Math.floor(e/60),a=(e%60).toFixed(1);return`${n}:${a.padStart(4,"0")}`},ha=()=>{if(F)return;const e=E;T(!E),e?kt({action:"paused",position:He}):kt({action:"played",position:te,duration:ce-te})},ga=async()=>{if(!(F||ie||A)){Ct(!0),X(null),ye("");try{const e=de();if(!e)throw new Error("No audio source available");const n=typeof window<"u"&&window.__API_BASE_URL__,a=`${n.replace(/\/$/,"")}/api/extract-vocals`;f("ðŸŽ¤ [EXTRACT VOCALS] Starting vocal extraction:",{audioSource:e.isUploaded?"uploaded file":"external URL"});let r;if(e.isUploaded&&e.file){let h=ta;if(h)f("â™»ï¸ [EXTRACT VOCALS] Reusing S3 URL from BPM detection:",h);else{f("ðŸ“¤ [EXTRACT VOCALS] Uploading file to S3 first...");const v=await fetch(`${n.replace(/\/$/,"")}/api/s3-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.file.name,contentType:e.file.type||"audio/mpeg"})});if(!v.ok)throw new Error("Failed to get presigned upload URL");const{uploadUrl:U,publicUrl:K}=await v.json();if(!(await fetch(U,{method:"PUT",body:e.file,headers:{"Content-Type":e.file.type||"audio/mpeg"}})).ok)throw new Error("Failed to upload file to S3");h=K,qe(h),f("âœ… [EXTRACT VOCALS] File uploaded to S3:",h)}r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioUrl:h,trackName:J||oe||"audio-track"})})}else if(e.url)r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audioUrl:e.url,trackName:J||e.name||"audio-track"})});else throw new Error("No valid audio source available");if(!r.ok){let h="Server failed to extract vocals.";try{const v=await r.json();v!=null&&v.error&&(h=v.error)}catch{r.status>=500&&(h="Server error. Please try again later.")}throw new Error(h)}const o=await r.json();f("âœ… [EXTRACT VOCALS] Extraction complete:",{vocalsUrl:o.vocalsUrl,musicUrl:o.musicUrl});const c=new(window.AudioContext||window.webkitAudioContext),m=await(await fetch(o.vocalsUrl)).arrayBuffer(),w=await c.decodeAudioData(m);le.current=w;const b=await(await fetch(o.musicUrl)).arrayBuffer(),d=await c.decodeAudioData(b);Ce.current=d;const l=await st(w),p=await st(d),[g,S]=ca(l,p);Et(g),jt(S),Tt(o.vocalsUrl),Ut(o.musicUrl),At(!0),at(!0),nt(!0),ft(w.duration),xe(!1),f("ðŸŽµ [EXTRACT VOCALS] Audio buffers loaded and waveforms generated",{vocalsWaveformLength:l.length,musicWaveformLength:p.length})}catch(e){Ee("âŒ [EXTRACT VOCALS] Failed to extract vocals:",e);const n=e!=null&&e.message&&typeof e.message=="string"?e.message:"Something went wrong while extracting vocals.";X(n)}finally{Ct(!1)}}},wa=async()=>{var a,r;if(F||Ye||!Me)return;if(A){if(!le.current||!Ce.current){X("Audio tracks are not ready yet. Please wait for the waveforms to finish loading.");return}}else if(!re.current){X("Audio is not ready yet. Please wait for the waveform to finish loading.");return}xt(!0),X(null),ye("");const e=typeof window<"u"&&window.__API_BASE_URL__,n=`${e.replace(/\/$/,"")}/api/audio-process`;try{const o=A?((a=le.current)==null?void 0:a.duration)||0:((r=re.current)==null?void 0:r.duration)||0,c=C*o,s=(y-C)*o;f("ðŸ“¤ [AUDIO EXPORT] Preparing server-side processing:",{mode:A?"dual track":"single track",startTime:`${c.toFixed(2)}s`,duration:`${s.toFixed(2)}s`,format:P,fadeInEnabled:k,fadeInDuration:L,fadeOutEnabled:I,fadeOutDuration:D});let m;const w=A&&j===!0&&N===!0;if(f("ðŸ“¤ [AUDIO EXPORT] Export conditions:",{isVocalsMode:A,vocalsEnabled:j,musicEnabled:N,bothTracksEnabled:w,vocalsAudioUrl:!!et,musicAudioUrl:!!tt}),w){const d=de();if(!d)throw new Error("No audio source available");if(d.isUploaded&&d.file){f("ðŸ“¤ [AUDIO EXPORT] Uploading original file to S3 first (both tracks enabled)...");const l=await fetch(`${e.replace(/\/$/,"")}/api/s3-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:d.file.name,contentType:d.file.type||"audio/mpeg"})});if(!l.ok)throw new Error("Failed to get presigned upload URL");const{uploadUrl:p,publicUrl:g}=await l.json();if(!(await fetch(p,{method:"PUT",body:d.file,headers:{"Content-Type":d.file.type||"audio/mpeg"}})).ok)throw new Error("Failed to upload file to S3");f("âœ… [AUDIO EXPORT] Original file uploaded to S3:",g);const h=new URLSearchParams;h.append("audioUrl",g),h.append("format",P),h.append("trackName",ge(J||oe||"audio-track")),h.append("startTime",c.toString()),h.append("duration",s.toString()),h.append("fadeInEnabled",String(k)),h.append("fadeInDuration",L.toString()),h.append("fadeOutEnabled",String(I)),h.append("fadeOutDuration",D.toString()),m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.toString()})}else{const l=new URLSearchParams;l.append("audioUrl",d.url),l.append("format",P),l.append("trackName",ge(J||oe||"audio-track")),l.append("startTime",c.toString()),l.append("duration",s.toString()),l.append("fadeInEnabled",String(k)),l.append("fadeInDuration",L.toString()),l.append("fadeOutEnabled",String(I)),l.append("fadeOutDuration",D.toString()),m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l.toString()})}}else if(A&&et&&tt&&!(j===!0&&N===!0)){f("ðŸ“¤ [AUDIO EXPORT] Using dual track processing (one or both tracks disabled)");const d=new URLSearchParams;d.append("vocalsUrl",et),d.append("musicUrl",tt),d.append("vocalsEnabled",String(j)),d.append("musicEnabled",String(N)),d.append("format",P),d.append("trackName",ge(J||oe||"audio-track")),d.append("startTime",c.toString()),d.append("duration",s.toString()),d.append("fadeInEnabled",String(k)),d.append("fadeInDuration",L.toString()),d.append("fadeOutEnabled",String(I)),d.append("fadeOutDuration",D.toString()),m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()})}else{if(A)throw new Error("Vocals mode is active but audio URLs are not available");{const d=de();if(!d)throw new Error("No audio source available");if(d.isUploaded&&d.file){f("ðŸ“¤ [AUDIO EXPORT] Uploading file to S3 first...");const l=await fetch(`${e.replace(/\/$/,"")}/api/s3-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:d.file.name,contentType:d.file.type||"audio/mpeg"})});if(!l.ok)throw new Error("Failed to get presigned upload URL");const{uploadUrl:p,publicUrl:g}=await l.json();if(!(await fetch(p,{method:"PUT",body:d.file,headers:{"Content-Type":d.file.type||"audio/mpeg"}})).ok)throw new Error("Failed to upload file to S3");f("âœ… [AUDIO EXPORT] File uploaded to S3:",g);const h=new URLSearchParams;h.append("audioUrl",g),h.append("format",P),h.append("trackName",ge(J||oe||"audio-track")),h.append("startTime",c.toString()),h.append("duration",s.toString()),h.append("fadeInEnabled",String(k)),h.append("fadeInDuration",L.toString()),h.append("fadeOutEnabled",String(I)),h.append("fadeOutDuration",D.toString()),m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:h.toString()})}else if(d.url){const l=new URLSearchParams;l.append("audioUrl",d.url),l.append("format",P),l.append("trackName",ge(J||d.name||"audio-track")),l.append("startTime",c.toString()),l.append("duration",s.toString()),l.append("fadeInEnabled",String(k)),l.append("fadeInDuration",L.toString()),l.append("fadeOutEnabled",String(I)),l.append("fadeOutDuration",D.toString()),m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l.toString()})}else throw new Error("No valid audio source available")}}if(!m.ok){let d="Server failed to export audio.";try{const l=await m.json();l!=null&&l.error&&(d=l.error)}catch{try{const l=await m.text();l&&(d=l)}catch{m.status===413?d="File too large. Maximum file size is 500MB. Please try trimming your audio or selecting a shorter segment.":m.status>=500&&(d="Server error. Please try again later.")}}throw new Error(d)}const x=await m.json();if(!x.downloadUrl)throw new Error("Server response did not include a download URL.");const b=x.downloadUrl;yt(b),ye("Your audio download link is ready."),Ua({format:P,duration:s,start_trim:C,end_trim:y,fade_in_enabled:k,fade_out_enabled:I,fade_in_duration:L,fade_out_duration:D,source:Be!=null&&Be.isUploaded?"manual":"chatgpt_url"});try{let d=`Audio generated successfully! Download it here: ${b}`;const l=[];z!=null&&l.push(`BPM: ${z}`),ne&&l.push(`Key: ${ne}`),l.length>0&&(d+=`

${l.join(`
`)}`),await aa(d),f("ðŸ’¬ [FOLLOW UP MESSAGE] Sent follow-up message with S3 download URL.",{hasBpm:z!=null,hasKey:!!ne})}catch(d){Ue("âš ï¸ [FOLLOW UP MESSAGE] Failed to send follow-up message:",d)}f("ðŸ”— [AUDIO DOWNLOAD] Resolved download URL:",b)}catch(o){Ee("âŒ [AUDIO GENERATE] Failed to export audio:",o),Ft({error_type:"export",error_message:(o==null?void 0:o.message)||"Unknown error exporting audio",context:{format:P,has_audio:!!re.current}});const c=o!=null&&o.message&&typeof o.message=="string"?o.message:"Something went wrong while exporting the audio.";X(c)}finally{setTimeout(()=>{xt(!1)},200)}},Rt=e=>{if($===0)return;const n=e/$,a=Math.max(0,Math.min(C+n,y-.05));Ne(a),R(a)},Lt=e=>{if($===0)return;const n=e/$,a=Math.max(C+.05,Math.min(y+n,1));Oe(a),R(a)},va=e=>{const n=P,a=Vt(e);je(a),_e(!1),Ta({old_format:n,new_format:a,mode:O?"ringtone":"audio"})},Dt=e=>e.touches&&e.touches.length>0?e.touches[0].clientX:e.changedTouches&&e.changedTouches.length>0?e.changedTouches[0].clientX:e.clientX,ue=e=>{if(!H.current)return;e.preventDefault(),E?(Z.current=!0,T(!1)):Z.current=!1;const n=H.current.getBoundingClientRect(),a=Dt(e)-n.left,r=Math.max(0,Math.min(1,a/n.width));R(r),vt(!0)},Ie=i.useCallback(e=>{if(!H.current)return;e.preventDefault();const n=H.current.getBoundingClientRect(),a=Dt(e)-n.left,r=Math.max(0,Math.min(1,a/n.width));if(Pe){E&&(Z.current=!0,T(!1));const o=Math.min(r,y-.05);Ne(o),R(o)}else if(Re){E&&(Z.current=!0,T(!1));const o=Math.max(r,C+.05);Oe(o),R(o)}else Le&&(E&&(Z.current=!0,T(!1)),R(r))},[Pe,Re,Le,E,y,C]),me=i.useCallback(e=>{e.type==="touchend"&&e.preventDefault();const n=Z.current;gt(!1),wt(!1),vt(!1),Z.current=!1,n&&setTimeout(()=>T(!0),100)},[]),q=(e,n)=>{n.preventDefault(),n.stopPropagation(),E?(Z.current=!0,T(!1)):Z.current=!1,e==="start"?gt(!0):e==="end"&&wt(!0)};i.useEffect(()=>{if(Pe||Re||Le)return document.addEventListener("mousemove",Ie),document.addEventListener("mouseup",me),document.addEventListener("touchmove",Ie,{passive:!1}),document.addEventListener("touchend",me,{passive:!1}),document.addEventListener("touchcancel",me,{passive:!1}),()=>{document.removeEventListener("mousemove",Ie),document.removeEventListener("mouseup",me),document.removeEventListener("touchmove",Ie),document.removeEventListener("touchend",me),document.removeEventListener("touchcancel",me)}},[Pe,Re,Le]);const Be=de();return Be?t.jsxs("div",{className:"ringtone-editor",children:[t.jsx("input",{ref:ee,id:"audio-file-input-replace",type:"file",accept:"audio/*,.mp3,.wav,.m4a,.aac,.ogg,.webm",onChange:fa,style:{display:"none"},"aria-label":"Replace audio file"}),t.jsxs("div",{className:"ringtone-header",children:[t.jsx("button",{onClick:ha,disabled:F||A&&!j&&!N,className:`play-button ${E?"playing":""} ${F?"loading":""}`,"aria-label":E?"Pause":"Play",title:A&&!j&&!N?"Enable at least one track to play":void 0,children:F?t.jsx("span",{className:"loading-spinner",children:"..."}):E?t.jsxs("svg",{className:"play-icon",width:"35",height:"35",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M6.5 7.75C6.5 7.05964 7.05964 6.5 7.75 6.5H9.25C9.94036 6.5 10.5 7.05964 10.5 7.75V16.25C10.5 16.9404 9.94036 17.5 9.25 17.5H7.75C7.05964 17.5 6.5 16.9404 6.5 16.25V7.75Z",fill:"currentColor"}),t.jsx("path",{d:"M13.5 7.75C13.5 7.05964 14.0596 6.5 14.75 6.5H16.25C16.9404 6.5 17.5 7.05964 17.5 7.75V16.25C17.5 16.9404 16.9404 17.5 16.25 17.5H14.75C14.0596 17.5 13.5 16.9404 13.5 16.25V7.75Z",fill:"currentColor"})]}):t.jsx("svg",{className:"play-icon",width:"35",height:"35",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M8 16.7229V7.27711C8 6.29075 9.08894 5.69298 9.9211 6.22254L17.3428 10.9454C18.1147 11.4366 18.1147 12.5634 17.3428 13.0546L9.92109 17.7775C9.08894 18.3071 8 17.7093 8 16.7229Z",fill:"currentColor"})})}),t.jsx("div",{className:`track-name-marquee ${ve?"loading":""}`,children:t.jsx("div",{ref:Ke,className:`marquee-content ${ve?"loading":""}`,children:ve?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner","aria-hidden":"true"}),t.jsx("span",{children:"Loading attributes..."})]}):t.jsx("span",{children:qt||Mt()})})}),t.jsx("button",{className:"header-tools-button replace-audio-button",onClick:e=>{e.preventDefault(),ee.current&&ee.current.click()},"aria-label":"Replace audio file",title:"Replace audio file",children:t.jsx("svg",{className:"button-svg-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M18.032 5.024C17.75 5 17.377 5 16.8 5h-5.3c-.2 1-.401 1.911-.61 2.854-.131.596-.247 1.119-.523 1.56a2.998 2.998 0 0 1-.953.954c-.441.275-.964.39-1.56.522l-.125.028-2.512.558A1.003 1.003 0 0 1 5 11.5v5.3c0 .577 0 .949.024 1.232.022.272.06.372.085.422a1 1 0 0 0 .437.437c.05.025.15.063.422.085C6.25 19 6.623 19 7.2 19H10a1 1 0 1 1 0 2H7.161c-.527 0-.981 0-1.356-.03-.395-.033-.789-.104-1.167-.297a3 3 0 0 1-1.311-1.311c-.193-.378-.264-.772-.296-1.167A17.9 17.9 0 0 1 3 16.838V11c0-2.075 1.028-4.067 2.48-5.52C6.933 4.028 8.925 3 11 3h5.838c.528 0 .982 0 1.357.03.395.033.789.104 1.167.297a3 3 0 0 1 1.311 1.311c.193.378.264.772.296 1.167.031.375.031.83.031 1.356V10a1 1 0 1 1-2 0V7.2c0-.577 0-.949-.024-1.232-.022-.272-.06-.373-.085-.422a1 1 0 0 0-.437-.437c-.05-.025-.15-.063-.422-.085ZM5.28 9.414l2.015-.448c.794-.177.948-.225 1.059-.294a1 1 0 0 0 .318-.318c.069-.11.117-.265.294-1.059l.447-2.015c-.903.313-1.778.874-2.518 1.615-.741.74-1.302 1.615-1.615 2.518ZM17 15a1 1 0 1 1 2 0v2h2a1 1 0 1 1 0 2h-2v2a1 1 0 1 1-2 0v-2h-2a1 1 0 1 1 0-2h2v-2Z",fill:"currentColor"})})}),t.jsx("button",{className:"header-tools-button extract-vocals-button",onClick:e=>{e.preventDefault(),ga()},disabled:ie||A||F,"aria-label":"Separate vocals",title:A?"Vocals already separated":ie?"Separating...":"Separate vocals",children:ie?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner","aria-hidden":"true"}),t.jsx("span",{className:"extract-vocals-text",children:na})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"button-svg-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M18 2C18.5523 2 19 2.44772 19 3V15C19 15.5523 18.5523 16 18 16C17.4477 16 17 15.5523 17 15V3C17 2.44772 17.4477 2 18 2ZM11 3C11.5523 3 12 3.44772 12 4V5.5C12 6.05228 11.5523 6.5 11 6.5C10.4477 6.5 10 6.05228 10 5.5V4C10 3.44772 10.4477 3 11 3ZM14.5 5C15.0523 5 15.5 5.44772 15.5 6V12.25C15.5 12.8023 15.0523 13.25 14.5 13.25C13.9477 13.25 13.5 12.8023 13.5 12.25V6C13.5 5.44772 13.9477 5 14.5 5ZM21.5 7C22.0523 7 22.5 7.44772 22.5 8V10C22.5 10.5523 22.0523 11 21.5 11C20.9477 11 20.5 10.5523 20.5 10V8C20.5 7.44772 20.9477 7 21.5 7ZM8 10C7.17157 10 6.5 10.6716 6.5 11.5C6.5 12.3284 7.17157 13 8 13C8.82843 13 9.5 12.3284 9.5 11.5C9.5 10.6716 8.82843 10 8 10ZM4.5 11.5C4.5 9.567 6.067 8 8 8C9.933 8 11.5 9.567 11.5 11.5C11.5 13.433 9.933 15 8 15C6.067 15 4.5 13.433 4.5 11.5ZM5.14202 18.815C4.43814 19.3155 4 20.0257 4 21C4 21.5523 3.55228 22 3 22C2.44772 22 2 21.5523 2 21C2 19.3077 2.81186 18.0179 3.98298 17.1851C5.12436 16.3734 6.58924 16 8 16C9.41076 16 10.8756 16.3734 12.017 17.1851C13.1881 18.0178 14 19.3076 14 21C14 21.5523 13.5523 22 13 22C12.4477 22 12 21.5523 12 21C12 20.0257 11.5619 19.3155 10.858 18.815C10.1244 18.2933 9.08924 18 8 18C6.91076 18 5.87564 18.2933 5.14202 18.815Z",fill:"currentColor"})}),t.jsx("span",{className:"extract-vocals-text",children:"Separate vocals"})]})}),t.jsxs("div",{className:"format-dropdown-container",children:[t.jsxs("button",{className:"format-dropdown",onClick:()=>_e(!mt),children:[t.jsx("span",{children:(()=>{const e=typeof window<"u"&&window.innerWidth<=424;return O?P==="m4r"?e?"iPhone":"For iPhone":e?"Android":"For Android":e?`.${P}`:`Export as .${P}`})()}),t.jsx("svg",{width:"14",height:"8",viewBox:"0 0 14 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M0.292892 0.292894C0.683416 -0.0976306 1.31658 -0.0976315 1.70711 0.292892L7.00002 5.58579L12.2929 0.292894C12.6834 -0.0976306 13.3166 -0.0976315 13.7071 0.292892C14.0976 0.683416 14.0976 1.31658 13.7071 1.70711L7.70713 7.70711C7.51959 7.89464 7.26524 8 7.00002 8C6.7348 8 6.48045 7.89464 6.29291 7.70711L0.292894 1.70711C-0.0976306 1.31658 -0.0976315 0.683419 0.292892 0.292894Z",fill:"currentColor"})})]}),mt&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"dropdown-overlay",onClick:()=>_e(!1)}),t.jsx("div",{className:"format-dropdown-menu",children:(O?Ma:Wt).map(e=>t.jsxs("button",{onClick:()=>va(e.value),className:P===e.value?"active":"",children:[t.jsx("span",{children:e.label}),P===e.value&&t.jsx("svg",{width:"14",height:"13",viewBox:"0 0 14 13",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M13.5633 0.173869C14.0196 0.484992 14.1374 1.10712 13.8262 1.56343L6.32623 12.5634C6.15848 12.8095 5.88982 12.9679 5.59335 12.9957C5.29688 13.0235 5.00345 12.9178 4.79289 12.7072L0.292893 8.2072C-0.0976311 7.81668 -0.0976311 7.18351 0.292893 6.79299C0.683417 6.40247 1.31658 6.40247 1.70711 6.79299L5.35368 10.4396L12.1738 0.43676C12.4849 -0.0195528 13.107 -0.137253 13.5633 0.173869Z",fill:"currentColor"})})]},e.value))})]})]})]}),t.jsxs("div",{className:"waveform-section",ref:De,children:[t.jsxs("div",{className:"time-markers-container",children:[t.jsx("div",{className:"time-cue-lines-container",children:[...Array(11)].map((e,n)=>t.jsx("div",{className:"time-cue-line",style:{left:`${n*10}%`}},`cue-${n}`))}),t.jsxs("div",{className:"time-markers",children:[t.jsx("span",{children:"0:00.0"}),t.jsx("span",{children:$>0?ke($/2):"0:00.0"}),t.jsx("span",{children:$>0?ke($):"0:00.0"})]})]}),t.jsx("div",{className:"trimmer-line",style:{left:`${ra}%`}}),A?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"trim-pin start-pin vocals-mode-start-pin",style:{left:`${Nt}%`},width:"60",height:"65",viewBox:"0 0 60 65",onMouseDown:e=>q("start",e),onTouchStart:e=>q("start",e),children:t.jsx("path",{d:"M 0 30 A 30 30 0 0 1 60 30 L 30 65 Z",fill:"var(--blue)"})}),t.jsx("svg",{className:"trim-pin end-pin vocals-mode-end-pin",style:{left:`${Ot}%`},width:"60",height:"65",viewBox:"0 0 60 65",onMouseDown:e=>q("end",e),onTouchStart:e=>q("end",e),children:t.jsx("path",{d:"M 30 0 L 0 35 A 30 30 0 0 0 60 35 Z",fill:"var(--blue)"})})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"trim-pin start-pin",style:{left:`${Nt}%`},width:"60",height:"65",viewBox:"0 0 60 65",onMouseDown:e=>q("start",e),onTouchStart:e=>q("start",e),children:t.jsx("path",{d:"M 0 30 A 30 30 0 0 1 60 30 L 30 65 Z",fill:"var(--blue)"})}),t.jsx("svg",{className:"trim-pin end-pin",style:{left:`${Ot}%`},width:"60",height:"65",viewBox:"0 0 60 65",onMouseDown:e=>q("end",e),onTouchStart:e=>q("end",e),children:t.jsx("path",{d:"M 30 0 L 0 35 A 30 30 0 0 0 60 35 Z",fill:"var(--blue)"})})]}),A?t.jsxs("div",{className:"waveform-dual-container",children:[t.jsxs("div",{className:`waveform-track ${j?"":"track-disabled"}`,children:[t.jsxs("div",{className:"waveform-toggle-container",children:[t.jsx("button",{className:`toggle-switch ${j?"enabled":""}`,onClick:()=>{const e=E;e&&T(!1),at(!j),e&&(!j||N)&&setTimeout(()=>T(!0),100)},"aria-label":"Toggle vocals track",children:t.jsx("div",{className:"toggle-slider"})}),t.jsx("span",{className:"waveform-track-label",children:"Vocals"})]}),t.jsx("div",{className:"waveform-container",ref:H,onMouseDown:ue,onTouchStart:ue,children:F||Ae.length===0?t.jsx("div",{className:"waveform-loading",children:"Loading audio..."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"waveform-background",children:Ae.map((e,n)=>t.jsx("div",{className:"waveform-bar background-bar",style:{height:`${e*100}%`}},n))}),t.jsx("div",{className:"waveform-selected",children:Ae.map((e,n)=>{const a=n/Ae.length;if(!(a>=C&&a<=y))return null;const o=Ae.length,c=70/o,s=n/o*100;return t.jsx("div",{className:"waveform-bar selected-bar",style:{height:`${e*100}%`,position:"absolute",left:`${s}%`,width:`${c}%`}},`vocals-selected-${n}`)})})]})})]}),t.jsxs("div",{className:`waveform-track music-track ${N?"":"track-disabled"}`,children:[t.jsxs("div",{className:"waveform-toggle-container",children:[t.jsx("button",{className:`toggle-switch ${N?"enabled":""}`,onClick:()=>{const e=E;e&&T(!1),nt(!N),e&&(j||!N)&&setTimeout(()=>T(!0),100)},"aria-label":"Toggle Background track",children:t.jsx("div",{className:"toggle-slider"})}),t.jsx("span",{className:"waveform-track-label",children:"Backing"})]}),t.jsx("div",{className:"waveform-container",onMouseDown:ue,onTouchStart:ue,children:F||Te.length===0?t.jsx("div",{className:"waveform-loading",children:"Loading audio..."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"waveform-background",children:Te.map((e,n)=>t.jsx("div",{className:"waveform-bar background-bar",style:{height:`${e*100}%`}},n))}),t.jsx("div",{className:"waveform-selected",children:Te.map((e,n)=>{const a=n/Te.length;if(!(a>=C&&a<=y))return null;const o=Te.length,c=70/o,s=n/o*100;return t.jsx("div",{className:"waveform-bar selected-bar",style:{height:`${e*100}%`,position:"absolute",left:`${s}%`,width:`${c}%`}},`music-selected-${n}`)})})]})})]})]}):t.jsx("div",{className:"waveform-container",ref:H,onMouseDown:ue,onTouchStart:ue,children:F?t.jsx("div",{className:"waveform-loading",children:"Loading audio..."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"waveform-background",children:we.map((e,n)=>t.jsx("div",{className:"waveform-bar background-bar",style:{height:`${e*100}%`}},n))}),t.jsx("div",{className:"waveform-selected",children:we.map((e,n)=>{const a=n/we.length;if(!(a>=C&&a<=y))return null;const o=we.length,c=70/o,s=n/o*100;return t.jsx("div",{className:"waveform-bar selected-bar",style:{height:`${e*100}%`,position:"absolute",left:`${s}%`,width:`${c}%`}},`selected-${n}`)})})]})}),t.jsx("div",{className:"trimmer-label",children:"TRIMMER"})]}),t.jsxs("div",{className:"trim-controls",children:[t.jsxs("div",{className:"control-section start-section",children:[t.jsx("div",{className:"trim-control",children:t.jsxs("div",{className:"trim-time-controls",children:[t.jsx("button",{className:"trim-button",onClick:()=>Rt(-.1),disabled:C<=0,children:t.jsx("svg",{width:"16",height:"3",viewBox:"0 0 12 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M0 1C0 0.447715 0.447715 0 1 0H11C11.5523 0 12 0.447715 12 1C12 1.55228 11.5523 2 11 2H1C0.447715 2 0 1.55228 0 1Z",fill:"currentColor"})})}),t.jsx("span",{className:"trim-time",children:ke(te)}),t.jsx("button",{className:"trim-button",onClick:()=>Rt(.1),disabled:C>=y-.05,children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M6 0C6.55228 0 7 0.447715 7 1V5H11C11.5523 5 12 5.44772 12 6C12 6.55228 11.5523 7 11 7H7V11C7 11.5523 6.55228 12 6 12C5.44772 12 5 11.5523 5 11V7H1C0.447715 7 0 6.55228 0 6C0 5.44772 0.447715 5 1 5H5V1C5 0.447715 5.44772 0 6 0Z",fill:"currentColor"})})})]})}),t.jsx("div",{className:"fade-control",children:t.jsxs("div",{className:"fade-toggle-container",children:[t.jsx("button",{className:`toggle-switch ${k?"enabled":""}`,onClick:()=>{dt(e=>{const n=!e;if(n){const a=ce-te,r=Math.min(It,Math.max(a,0));Ve(o=>o>0?Math.min(o,a):r),$e({fade_type:"in",enabled:!0,duration:r})}else Ve(0),$e({fade_type:"in",enabled:!1,duration:0});return n})},children:t.jsx("div",{className:"toggle-slider"})}),t.jsx("span",{className:"fade-label",children:"Fade In"})]})})]}),t.jsxs("div",{className:"control-section end-section",children:[t.jsx("div",{className:"trim-control",children:t.jsxs("div",{className:"trim-time-controls",children:[t.jsx("button",{className:"trim-button",onClick:()=>Lt(-.1),disabled:y<=C+.05,children:t.jsx("svg",{width:"16",height:"3",viewBox:"0 0 12 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M0 1C0 0.447715 0.447715 0 1 0H11C11.5523 0 12 0.447715 12 1C12 1.55228 11.5523 2 11 2H1C0.447715 2 0 1.55228 0 1Z",fill:"currentColor"})})}),t.jsx("span",{className:"trim-time",children:ke(ce)}),t.jsx("button",{className:"trim-button",onClick:()=>Lt(.1),disabled:y>=1,children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M6 0C6.55228 0 7 0.447715 7 1V5H11C11.5523 5 12 5.44772 12 6C12 6.55228 11.5523 7 11 7H7V11C7 11.5523 6.55228 12 6 12C5.44772 12 5 11.5523 5 11V7H1C0.447715 7 0 6.55228 0 6C0 5.44772 0.447715 5 1 5H5V1C5 0.447715 5.44772 0 6 0Z",fill:"currentColor"})})})]})}),t.jsx("div",{className:"fade-control",children:t.jsxs("div",{className:"fade-toggle-container",children:[t.jsx("span",{className:"fade-label",children:"Fade Out"}),t.jsx("button",{className:`toggle-switch ${I?"enabled":""}`,onClick:()=>{ut(e=>{const n=!e;if(n){const a=ce-te,r=Math.min(It,Math.max(a,0));We(o=>o>0?Math.min(o,a):r),$e({fade_type:"out",enabled:!0,duration:r})}else We(0),$e({fade_type:"out",enabled:!1,duration:0});return n})},children:t.jsx("div",{className:"toggle-slider"})})]})})]})]}),t.jsxs("div",{className:"submit-container",children:[t.jsxs("div",{className:"rights-confirmation",children:[t.jsx("button",{className:`toggle-switch ${Me?"enabled":""}`,onClick:()=>zt(!Me),children:t.jsx("div",{className:"toggle-slider"})}),t.jsx("span",{className:"rights-text",children:"I own the rights to use this audio."})]}),t.jsx("button",{className:"generate-button",onClick:wa,disabled:A&&!j&&!N||!Me||F||Ye,title:A&&!j&&!N?"Enable at least one track to export":void 0,children:Ye?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"spinner","aria-hidden":"true"}),"Exporting..."]}):"Export audio"}),bt&&t.jsx("div",{className:"generation-status success",children:Je?t.jsxs(t.Fragment,{children:["Your audio"," ",t.jsx("a",{href:Je,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"underline",color:"inherit"},onClick:e=>{e.preventDefault(),window.open(Je,"_blank","noopener,noreferrer")},children:"download link"})," ","is ready."]}):bt}),St&&t.jsx("div",{className:"generation-status error",role:"alert",children:St})]})]}):t.jsxs("div",{className:"ringtone-editor",children:[t.jsx("div",{className:"ringtone-header",children:t.jsx("div",{className:"upload-title-container",children:t.jsx("h2",{className:"upload-title",children:"Audio Editor"})})}),t.jsx("div",{className:"waveform-container",children:t.jsx("div",{className:"upload-area",children:t.jsx("p",{className:"upload-description",style:{color:"var(--error-color, #ef4444)"},children:"No audio file provided. Please use the upload component first."})})})]})}ja.createRoot(document.getElementById("audio-editor-root")).render(t.jsx(Oa,{}));
