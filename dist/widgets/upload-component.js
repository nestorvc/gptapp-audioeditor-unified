import{u as b,l as j,b as M,a as T,r as m,j as o,i as L,k as R,R as _}from"./analytics-DONYtF83.js";const F=(a,t="audio")=>{if(!a||typeof a!="string")return t;const r=a.replace(/[<>:"/\\|?*\x00-\x1F]/g,"").trim().replace(/\s+/g,"-");return r.length>0?r:t};function S(){const a=b(),{callTool:t}=j();M(),T();const r=(a==null?void 0:a.mode)==="ringtone",[C,l]=m.useState(null),[P,f]=m.useState(!1),[s,d]=m.useState(!1),n=m.useRef(null),v=async e=>{var g,c;const i=((g=e==null?void 0:e.target)==null?void 0:g.value)??"";if(typeof i=="string"&&i.includes("/mnt/data/")){l("Looks like that file was attached in the ChatGPT chat. Please upload the audio directly through this screen."),n.current&&(n.current.value="");return}const u=(c=e.target.files)==null?void 0:c[0];u&&await N(u,"button")},w=e=>{e.preventDefault(),e.stopPropagation(),f(!0)},x=e=>{e.preventDefault(),e.stopPropagation(),f(!1)},D=async e=>{e.preventDefault(),e.stopPropagation(),f(!1);const i=e.dataTransfer.files;i&&i.length>0&&await N(i[0],"drag-drop")},N=async(e,i="button")=>{if(l(null),d(!0),!e){d(!1);return}if(typeof e.path=="string"&&e.path.includes("/mnt/data/")){l("Files attached in the ChatGPT chat can't be loaded. Please choose the audio file using this uploader."),d(!1);return}const u=["audio/mpeg","audio/mp3","audio/wav","audio/m4a","audio/x-m4a","audio/aac","audio/ogg","audio/webm"],g=[".mp3",".wav",".m4a",".aac",".ogg",".webm"],c="."+e.name.split(".").pop().toLowerCase();if(!u.includes(e.type)&&!g.includes(c)){l("Please upload a valid audio file (MP3, WAV, M4A, AAC, OGG, or WebM)"),d(!1);return}try{const p=F(e.name.replace(/\.[^/.]+$/,""),"audio-file");L({upload_method:i,file_type:e.type||c,file_size:e.size,file_name:p});const O=typeof window<"u"&&window.__API_BASE_URL__;if(!O){l("API URL not available. Please try again."),d(!1);return}const y=await fetch(`${O.replace(/\/$/,"")}/api/s3-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,contentType:e.type||"audio/mpeg"})});if(!y.ok)throw new Error("Failed to get presigned upload URL");const{uploadUrl:A,publicUrl:E}=await y.json();if(!(await fetch(A,{method:"PUT",body:e,headers:{"Content-Type":e.type||"audio/mpeg"}})).ok)throw new Error("Failed to upload file to S3");await t(r?"audio.open_ringtone_editor_with_file":"audio.open_audio_editor_with_file",{audioUrl:E}),n.current&&(n.current.value="")}catch(p){l((p==null?void 0:p.message)||"Failed to process file. Please try again."),d(!1)}},U=r?"Upload Ringtone File":"Upload Audio File";return o.jsxs("div",{className:"ringtone-editor",children:[o.jsx("div",{className:"ringtone-header",children:o.jsxs("div",{className:"upload-title-container",children:[o.jsx("svg",{className:"upload-title-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M8 5C8.55228 5 9 5.44772 9 6V18C9 18.5523 8.55228 19 8 19C7.44772 19 7 18.5523 7 18V6C7 5.44772 7.44772 5 8 5ZM16 7C16.5523 7 17 7.44772 17 8V16C17 16.5523 16.5523 17 16 17C15.4477 17 15 16.5523 15 16V8C15 7.44772 15.4477 7 16 7ZM12 8.5C12.5523 8.5 13 8.94772 13 9.5V14.5C13 15.0523 12.5523 15.5 12 15.5C11.4477 15.5 11 15.0523 11 14.5V9.5C11 8.94772 11.4477 8.5 12 8.5ZM4 9.5C4.55228 9.5 5 9.94772 5 10.5V13.5C5 14.0523 4.55228 14.5 4 14.5C3.44772 14.5 3 14.0523 3 13.5V10.5C3 9.94772 3.44772 9.5 4 9.5ZM20 9.5C20.5523 9.5 21 9.94772 21 10.5V13.5C21 14.0523 20.5523 14.5 20 14.5C19.4477 14.5 19 14.0523 19 13.5V10.5C19 9.94772 19.4477 9.5 20 9.5Z",fill:"currentColor"})}),o.jsx("h2",{className:"upload-title",children:U})]})}),o.jsxs("div",{className:"waveform-container",children:[o.jsx("input",{ref:n,id:"audio-file-input",type:"file",accept:"audio/*,.mp3,.wav,.m4a,.aac,.ogg,.webm",onChange:v,style:{display:"none"},"aria-label":"Upload audio file or Drag-n-drop here",disabled:s}),o.jsxs("div",{className:`upload-area ${P?"drag-over":""} ${s?"processing":""}`,onDragOver:w,onDragLeave:x,onDrop:D,onClick:e=>{e.preventDefault(),!s&&n.current&&n.current.click()},role:"button",tabIndex:0,onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&!s&&(e.preventDefault(),n.current&&n.current.click())},children:[s?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"spinner","aria-hidden":"true"}),o.jsx("p",{className:"upload-description",children:"Processing file..."})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"upload-description",children:P?"Drop your audio file here":o.jsxs(o.Fragment,{children:[o.jsx("b",{children:"Drag-n-drop"})," or ",o.jsx("b",{children:"choose an audio file"})," to edit"]})}),o.jsx("p",{className:"upload-hint",children:"Supports MP3, WAV, M4A, AAC, OGG, and WebM"})]}),C&&o.jsx("div",{className:"upload-error",role:"alert",children:C})]})]}),o.jsx("div",{className:"submit-container",children:o.jsx("button",{className:"generate-button",onClick:e=>{e.preventDefault(),!s&&n.current&&n.current.click()},disabled:s,children:s?"Processing...":"Select File or Drag-n-drop"})})]})}function h(){console.log("[UPLOAD-COMPONENT] Starting to render..."),console.log("[UPLOAD-COMPONENT] Document ready state:",document.readyState),console.log("[UPLOAD-COMPONENT] Window openai available:",!!window.openai);const a=document.getElementById("upload-component-root");if(console.log("[UPLOAD-COMPONENT] Root element found:",!!a),!a){console.error("[UPLOAD-COMPONENT] upload-component-root element not found");const t=Array.from(document.querySelectorAll("div"));console.log("[UPLOAD-COMPONENT] All divs in document:",t.map(r=>({id:r.id,className:r.className}))),setTimeout(h,100);return}try{console.log("[UPLOAD-COMPONENT] Creating React root...");const t=R.createRoot(a);console.log("[UPLOAD-COMPONENT] Rendering UploadComponent..."),t.render(_.createElement(S)),console.log("[UPLOAD-COMPONENT] Render complete!")}catch(t){console.error("[UPLOAD-COMPONENT] Error rendering UploadComponent:",t),a.innerHTML=`<div style="padding: 20px; color: red; font-family: sans-serif;">Error loading upload component: ${t.message}<br/><pre>${t.stack}</pre></div>`}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h();
